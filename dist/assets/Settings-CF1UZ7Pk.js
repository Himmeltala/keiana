import{D as t,C as e}from"./index-H7sj-gKN.js";import{U as h}from"./index-B3US37wA.js";import{d as E,h as x,l as I,y as V,c as F,g as a,b as l,w as d,u,a as m,o as R,e as D}from"./index-B3pEJO5H.js";const G={class:"mb-4"},M=a("div",{class:"mb-4"},[a("div",null,"设置"),a("div",{class:"text-0.8rem text-text-secondary"},"一些设置和管理")],-1),S={class:"flex-wrap f-c-b"},T={class:"f-c-c flex-basis-33.33% max-w-33.33%"},U={class:"f-c-c flex-basis-33.33% max-w-33.33%"},$=a("div",{class:"mb-4"},[a("div",null,"选项"),a("div",{class:"text-0.8rem text-text-secondary"},"配置预算、图表")],-1),J=E({__name:"Settings",async setup(j){let c,C;const o=([c,C]=x(()=>t.create()),c=await c,C(),c),B=([c,C]=x(()=>t.get(o,e.DB_CONFIG,e.DB_KEY_CONFIG)),c=await c,C(),c);async function O(){const _=await t.get(o,e.DB_RECORD),n=await t.get(o,e.DB_COMMENTS,e.DB_KEY_COMMENTS),s=await t.get(o,e.DB_CONFIG,e.DB_KEY_CONFIG),p=new Blob([JSON.stringify([{records:_,comments:n,config:s}])],{type:"text/json"}),f=document.createElement("a"),i=h.Dates.generateDate();f.download=`${i.y}-${i.m}-${i.d}${i.h}${i.minute}${i.second}.json`,f.href=URL.createObjectURL(p),f.click()}const g=async _=>{if(_.raw){const n=new FileReader;n.readAsText(_.raw),n.onload=()=>{const s=JSON.parse(n.result.toString());t.clear(o,e.DB_RECORD).then(()=>{s[0].records.forEach(p=>{t.leadIn(o,p,e.DB_RECORD)})}),t.clear(o,e.DB_COMMENTS).then(()=>{t.leadIn(o,s[0].comments,e.DB_COMMENTS)}),t.clear(o,e.DB_CONFIG).then(()=>{t.leadIn(o,s[0].config,e.DB_CONFIG)})}}};async function N(){await t.del(e.DB_TALLYPAD)}const r=I({...B});return V(r,(_,n,s)=>{t.put(o,e.DB_CONFIG,h.Objects.raw(_),e.DB_KEY_CONFIG)}),(_,n)=>{const s=m("el-button"),p=m("el-upload"),f=m("el-popconfirm"),i=m("el-input"),w=m("el-form-item"),y=m("el-switch"),v=m("el-form");return R(),F("div",null,[a("div",G,[M,a("div",S,[a("div",T,[l(s,{plain:"",round:"",type:"primary",onClick:O},{default:d(()=>[D("导出数据")]),_:1})]),l(p,{"auto-upload":!1,limit:1,"on-change":g,"show-file-list":!1,accept:"application/json",class:"f-c-c flex-basis-33.33% max-w-33.33%"},{default:d(()=>[l(s,{plain:"",round:"",type:"success"},{default:d(()=>[D("导入数据")]),_:1})]),_:1}),a("div",U,[l(f,{title:"确定清除数据？",onConfirm:N},{reference:d(()=>[l(s,{plain:"",round:"",type:"danger"},{default:d(()=>[D("清除数据")]),_:1})]),_:1})])])]),a("div",null,[$,a("div",null,[l(v,{model:u(r),class:"p-4","label-position":"left","label-width":"auto"},{default:d(()=>[l(w,{label:"总预算"},{default:d(()=>[l(i,{modelValue:u(r).budget,"onUpdate:modelValue":n[0]||(n[0]=b=>u(r).budget=b),size:"small",type:"number"},null,8,["modelValue"])]),_:1}),l(w,{label:u(r).isChart?"开启图表":"关闭图表"},{default:d(()=>[l(y,{modelValue:u(r).isChart,"onUpdate:modelValue":n[1]||(n[1]=b=>u(r).isChart=b)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])])])])}}});export{J as default};
